<!DOCTYPE html>
<html lang="es-CL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finaliza tu Compra</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5c6ac4; --success: #28c76f; --error: #de3618; --title-color: #2e3a59; --text-color: #637381; --text-light: #8898aa;
            --border-color: #e0e0e0; --input-bg: #fff; --card-bg: #fff; --body-bg: #f9fafb; --sidebar-bg: #fff; --white: #fff; --black: #000;
            --dark-gray: #333; --light-gray: #f4f4f4; --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --border-radius-sm: 8px; --border-radius-md: 12px; --border-radius-lg: 20px; --border-radius-full: 50%;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }

        html, body {
            height: 100%;
            font-family: var(--font-family);
            background-color: var(--body-bg);
            color: var(--title-color);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .page-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            height: 100%;
        }

        .main-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        @media (min-width: 992px) {
            .page-container { padding: 2em 1.5em; }
            .main-content {
                display: grid;
                grid-template-columns: 1fr 400px;
                grid-template-rows: auto 1fr;
                gap: 0 2.5em;
            }
            .progress-bar-container {
                grid-column: 1 / 2;
                grid-row: 1 / 2;
                margin-bottom: 2em !important;
            }
            .checkout-flow-container {
                grid-column: 1 / 2;
                grid-row: 2 / 3;
                overflow-y: auto;
                padding-right: 1em;
                scrollbar-width: thin;
                scrollbar-color: var(--border-color) transparent;
            }
            .checkout-flow-container::-webkit-scrollbar { width: 6px; }
            .checkout-flow-container::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 3px; }
            .sidebar {
                grid-column: 2 / 3;
                grid-row: 1 / 3;
            }
            #summaryCollapsible { display: flex !important; }
            .summary-collapsible-header { display: none !important; }
        }
        
        @media (max-width: 991px) {
            body, html { overflow-y: auto; }
            .main-content { padding: 1.5em 1em 100px 1em; }
            .footer-buttons {
                position: fixed; bottom: 0; left: 0; right: 0; z-index: 20;
                background: var(--white); padding: 1em;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
                border-top: 1px solid var(--border-color);
                flex-direction: row !important;
                justify-content: space-between !important;
                align-items: center !important;
            }
            .btn { width: auto !important; }
            .btn-primary { flex-grow: 1; }
            .btn-secondary { min-width: 100px; }
        }

        .progress-bar-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1em;
        }
        .progress-step { display: flex; flex-direction: column; align-items: center; gap: 0.5em; text-align: center; position: relative; flex: 1; }
        .step-circle { width: 32px; height: 32px; border-radius: var(--border-radius-full); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.875em; transition: background-color 0.3s, color 0.3s; background-color: var(--border-color); color: var(--text-color); z-index: 2; }
        .step-label { font-size: 0.75em; color: var(--text-color); font-weight: 500; }
        .progress-step.active .step-circle { background-color: var(--primary); color: var(--white); }
        .progress-step.completed .step-circle { background-color: var(--success); color: var(--white); }
        .progress-step:not(:last-child)::after { content: ''; position: absolute; top: 16px; left: 50%; height: 2px; width: 100%; background-color: var(--border-color); z-index: 1; transform: translateX(16px); }
        .progress-step.completed::after { background-color: var(--success); }
        
        .checkout-card { background-color: var(--card-bg); border-radius: var(--border-radius-md); box-shadow: 0 2px 8px rgba(0,0,0,0.04); margin-bottom: 1.5em; padding: 1.5em; }
        @media (min-width: 768px) { .checkout-card { padding: 2em; } }
        .card-header { margin-bottom: 1.5em; }
        .card-title { font-size: 1.25em; font-weight: 600; color: var(--title-color); margin-bottom: 0.25em; }
        .card-description { font-size: 0.9em; color: var(--text-light); }
        #checkoutForm { flex-grow: 1; display:flex; flex-direction:column; }
        .checkout-step { display: none; }
        .checkout-step.active { display: block; }

        .input-wrapper {
            position: relative;
            margin-bottom: 1.2em; /* ESPAÃ‡AMENTO REDUZIDO */
        }
        .input-label { display: block; font-size: 0.875em; font-weight: 600; margin-bottom: 0.5em; color: var(--title-color); }
        .checkout-input { width: 100%; padding: 0.75em 1em; border: 1.5px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1em; font-family: var(--font-family); transition: all 0.2s ease-in-out; background-color: var(--input-bg); height: 48px; }
        select.checkout-input { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.75em center; background-repeat: no-repeat; background-size: 1.25em 1.25em; padding-right: 2.5em; }
        .checkout-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(92,106,196,0.2); }
        .input-hint { font-size: 0.8em; color: var(--text-light); margin-top: 0.35em; display: block; }
        .form-grid { display: grid; gap: 0 1.5em; }
        @media (min-width: 768px) { .form-grid { grid-template-columns: 1fr 1fr; } }
        
        /* --- ESTILOS CORRIGIDOS PARA OS RADIOS --- */
        .option-methods-group { margin-top: 2em; }
        .option-methods-title { font-size: 1.125em; font-weight: 700; margin-bottom: 1em; color: var(--title-color); }
        .checkout-radio { display: flex; flex-direction: column; gap: 1em; }
        .checkout-radio label { cursor: pointer; display: block; }
        .checkout-radio input[type="radio"] { display: none; }
        .option-card { display: flex; align-items: center; gap: 1.25em; padding: 1.25em; border: 2px solid var(--border-color); border-radius: var(--border-radius-md); background: var(--card-bg); transition: all 0.2s ease-in-out; }
        .checkout-radio input[type="radio"]:checked + .option-card { border-color: var(--primary); box-shadow: 0 4px 12px rgba(92,106,196,0.15); }
        .checkout-radio label:hover .option-card { border-color: var(--primary); }
        .option-card-icon { color: var(--primary); flex-shrink: 0; }
        .option-card-icon svg { width: 32px; height: 32px; stroke-width: 1.5; }
        .option-card-main { flex-grow: 1; }
        .option-card-title { font-weight: 700; font-size: 1em; color: var(--title-color); }
        .option-card-subtitle { font-size: 0.85em; color: var(--text-color); }
        .option-card-badge { margin-left: auto; padding: 0.25em 0.75em; border-radius: var(--border-radius-lg); background-color: var(--black); color: var(--white); font-size: 0.8em; font-weight: 600; white-space: nowrap; }
        
        .sidebar { width: 100%; }
        .summary-collapsible-header {
            display: flex;
            justify-content: space-between; align-items: center; cursor: pointer;
            margin-bottom: 0.5em; padding: 1em; background: #f1f3f5;
            border-radius: 12px; font-weight: 600;
        }
        .summary-collapsible-header .text { display: flex; align-items: center; gap: 0.75em; }
        .summary-collapsible-header .total-price-preview { font-weight: 700; }
        #summaryCollapsible { display: none; margin-bottom: 1.5em; }
        
        .summary-card { background: var(--sidebar-bg); border-radius: var(--border-radius-md); padding: 1.5em; border: 1px solid #e5e7eb; display:flex; flex-direction:column; }
        @media (min-width: 992px) { .summary-card { box-shadow: 0 1px 4px rgba(0,0,0,0.05); height:100%; } }
        .summary-items-list { flex-grow: 1; overflow-y:auto; max-height: 30vh; }
        @media (min-width: 992px) { .summary-items-list { max-height: none; }}
        .summary-title { font-size: 1.2em; font-weight: 600; margin-bottom: 1.5em; }
        .summary-item { display: flex; align-items: center; gap: 1em; margin-bottom: 1em; }
        .summary-item-img { width: 64px; height: 64px; border-radius: var(--border-radius-sm); object-fit: cover; background-color: #eee; }
        .summary-item-details { flex: 1; min-width: 0;}
        .summary-item-name { font-weight: 600; font-size: .9em; line-height: 1.3; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .summary-item-qty { font-size: 0.85em; color: var(--text-light); }
        .summary-item-price { font-weight: 600; margin-left: 1em; white-space: nowrap; }
        .summary-totals { border-top: 1px solid var(--border-color); padding-top: 1.5em; margin-top: 1.5em; display: flex; flex-direction: column; gap: 0.75em; }
        .summary-line { display: flex; justify-content: space-between; font-size: 0.9em; }
        .summary-line.total { font-size: 1.1em; font-weight: 700; margin-top: 0.5em; }
        
        .coupon-form { display: flex; gap: 0.5em; margin-top: 1.5em; }
        .coupon-form .checkout-input { height: 44px; }
        .coupon-btn { padding: 0 1.25em; height: 44px; border: 0; background-color: var(--dark-gray); color: var(--white); border-radius: var(--border-radius-sm); font-weight: 500; cursor: pointer; }
        .coupon-btn:hover { background-color: var(--black); }
        
        .footer-buttons { margin-top: auto; padding-top: 1.5em; border-top: 1px solid var(--border-color); display: flex; flex-direction: column-reverse; gap: 1em; width: 100%; }
        .btn { display: inline-flex; align-items: center; justify-content: center; border-radius: var(--border-radius-lg); font-size: 1em; font-weight: 600; height: 48px; padding: 0 1.5em; cursor: pointer; transition: all 0.2s ease; border: 2px solid transparent; text-decoration: none; }
        .btn-primary { background-color: var(--black); color: var(--white); }
        .btn-primary:hover { background-color: var(--dark-gray); }
        .btn-secondary { background-color: transparent; color: var(--text-color); border-color: var(--border-color); }
        .btn-secondary:hover { background-color: var(--light-gray); border-color: #ccc; }
    </style>
</head>
<body>
    <div class="page-container">
        <main class="main-content">
            <div class="progress-bar-container"></div>
            
            <aside class="sidebar">
                <div class="summary-collapsible-header" id="summaryHeader">
                    <span class="text">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        <span id="summaryHeaderText">Mostrar resumen de la compra</span>
                    </span>
                    <span class="total-price-preview"></span>
                </div>
                <div class="summary-card" id="summaryCollapsible">
                    <h2 class="summary-title">Resumen de tu compra</h2>
                    <div class="summary-items-list" id="summary-items-list"><p>Cargando tu carrito...</p></div>
                    <form class="coupon-form">
                        <input type="text" class="checkout-input" placeholder="CupÃ³n de descuento">
                        <button type="button" class="coupon-btn">Aplicar</button>
                    </form>
                    <div class="summary-totals">
                        <div class="summary-line"><span class="label">Subtotal</span><span class="value" id="summary-subtotal"></span></div>
                        <div class="summary-line"><span class="label">EnvÃ­o</span><span class="value" id="summary-shipping">Gratis</span></div>
                        <div class="summary-line total"><span class="label">Total</span><span class="value" id="summary-total"></span></div>
                    </div>
                </div>
            </aside>

            <div class="checkout-flow-container">
                <form id="checkoutForm" novalidate>
                    </form>
                <div class="footer-buttons">
                    <button type="button" class="btn btn-secondary" id="backButton" style="display: none;">Volver</button>
                    <button type="button" class="btn btn-primary" id="nextButton">Continuar</button>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Injeta o HTML do formulÃ¡rio para manter o corpo do HTML limpo
        function injectFormHTML() {
            const formContainer = document.getElementById('checkoutForm');
            if (!formContainer) return;
            formContainer.innerHTML = `
                <div class="checkout-step" id="step1-content">
                    <div class="checkout-card">
                        <div class="card-header"><h2 class="card-title">1. Datos de Contacto</h2></div>
                        <div class="input-wrapper">
                            <label class="input-label" for="email">Correo electrÃ³nico</label>
                            <input id="email" type="email" class="checkout-input" placeholder="tucorreo@ejemplo.com" required>
                        </div>
                        <div class="form-grid">
                            <div class="input-wrapper">
                                <label class="input-label" for="name">Nombre y Apellido</label>
                                <input id="name" type="text" class="checkout-input" placeholder="Tu nombre y apellido" required>
                            </div>
                            <div class="input-wrapper">
                                <label class="input-label" for="rut">RUT</label>
                                <input id="rut" type="text" class="checkout-input" placeholder="12.345.678-9" required>
                            </div>
                        </div>
                        <div class="input-wrapper">
                            <label class="input-label" for="phone">TelÃ©fono</label>
                            <input id="phone" type="tel" class="checkout-input" placeholder="9 1234 5678" required>
                            <span class="input-hint">Lo usaremos para contactarte sobre tu pedido.</span>
                        </div>
                    </div>
                </div>
                <div class="checkout-step" id="step2-content">
                    <div class="checkout-card">
                        <div class="card-header"><h2 class="card-title">2. DirecciÃ³n de Despacho</h2></div>
                        <div class="input-wrapper">
                            <label class="input-label" for="address">DirecciÃ³n</label>
                            <input id="address" type="text" class="checkout-input" placeholder="Calle, NÃºmero, Depto." required>
                        </div>
                        <div class="form-grid">
                            <div class="input-wrapper">
                                <label class="input-label" for="region">RegiÃ³n</label>
                                <select id="region" class="checkout-input" required>
                                    <option value="" disabled selected>Selecciona tu regiÃ³n</option>
                                    <option value="AP">Arica y Parinacota</option>
                                    <option value="TA">TarapacÃ¡</option>
                                    <option value="AN">Antofagasta</option>
                                    <option value="AT">Atacama</option>
                                    <option value="CO">Coquimbo</option>
                                    <option value="VA">ValparaÃ­so</option>
                                    <option value="RM">Metropolitana de Santiago</option>
                                    <option value="OH">O'Higgins</option>
                                    <option value="MA">Maule</option>
                                    <option value="NB">Ã‘uble</option>
                                    <option value="BI">BiobÃ­o</option>
                                    <option value="AR">La AraucanÃ­a</option>
                                    <option value="LR">Los RÃ­os</option>
                                    <option value="LL">Los Lagos</option>
                                    <option value="AI">AysÃ©n</option>
                                    <option value="MG">Magallanes</option>
                                </select>
                            </div>
                            <div class="input-wrapper">
                                <label class="input-label" for="postal">CÃ³digo postal (Opcional)</label>
                                <input id="postal" type="text" class="checkout-input" placeholder="Ej: 8340457">
                            </div>
                        </div>
                        <div class="option-methods-group">
                            <h3 class="option-methods-title">MÃ©todo de Entrega</h3>
                            <div class="checkout-radio">
                                <label>
                                    <input type="radio" name="delivery" value="domicilio" checked>
                                    <div class="option-card">
                                        <div class="option-card-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11"></path><path d="M14 9h4l4 4v4h-8v-8Z"></path><circle cx="7.5" cy="18.5" r="2.5"></circle><circle cx="17.5" cy="18.5" r="2.5"></circle></svg></div>
                                        <div class="option-card-main">
                                            <div class="option-card-title">Despacho a domicilio</div>
                                            <div class="option-card-subtitle">RecÃ­belo en 24 a 48 hrs.</div>
                                        </div>
                                        <div class="option-card-badge">Gratis</div>
                                    </div>
                                </label>
                                <label>
                                    <input type="radio" name="delivery" value="retiro">
                                    <div class="option-card">
                                        <div class="option-card-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 21V10.99a1 1 0 0 1 .43-.82l7.12-5.46a1 1 0 0 1 1.15 0l7.12 5.46a1 1 0 0 1 .43.82V21"></path><path d="M9 21v-6.02a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1V21"></path></svg></div>
                                        <div class="option-card-main">
                                            <div class="option-card-title">Retiro en tienda</div>
                                            <div class="option-card-subtitle">Disponible en 2 horas</div>
                                        </div>
                                        <div class="option-card-badge" style="background-color: var(--success);">Â¡RÃ¡pido!</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="checkout-step" id="step3-content">
                    <div class="checkout-card">
                        <div class="card-header"><h2 class="card-title">3. Pago</h2><p class="card-description">Todas las transacciones son seguras y estÃ¡n encriptadas.</p></div>
                        <div class="checkout-radio">
                            <label><input type="radio" name="pago" value="tarjeta" checked><div class="option-card"><div class="option-card-main"><div class="option-card-title">Tarjeta de CrÃ©dito o DÃ©bito</div></div></div></label>
                            <label><input type="radio" name="pago" value="transferencia"><div class="option-card"><div class="option-card-main"><div class="option-card-title">Transferencia Bancaria</div></div></div></label>
                        </div>
                    </div>
                </div>`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            injectFormHTML();

            let currentStep = 1;
            const totalSteps = 3;
            const nextButton = document.getElementById('nextButton');
            const backButton = document.getElementById('backButton');
            const progressBarContainer = document.querySelector('.progress-bar-container');
            const summaryHeader = document.getElementById('summaryHeader');
            const summaryHeaderText = document.getElementById('summaryHeaderText');
            const summaryCollapsible = document.getElementById('summaryCollapsible');

            if (summaryHeader) {
                summaryHeader.addEventListener('click', () => {
                    const isHidden = summaryCollapsible.style.display === 'none' || summaryCollapsible.style.display === '';
                    summaryCollapsible.style.display = isHidden ? 'block' : 'none';
                    summaryHeaderText.textContent = isHidden ? 'Ocultar resumen de la compra' : 'Mostrar resumen de la compra';
                });
            }

            function populateSummary(cartData) {
                const itemsList = document.getElementById('summary-items-list');
                const subtotalEl = document.getElementById('summary-subtotal');
                const totalEl = document.getElementById('summary-total');
                const totalPreviewEl = document.querySelector('.total-price-preview');
                itemsList.innerHTML = '';
                if (!cartData || !cartData.items || cartData.items.length === 0) {
                    itemsList.innerHTML = '<p>No hay artÃ­culos en tu carrito.</p>';
                    return;
                }
                cartData.items.forEach(item => {
                    const itemPrice = (item.price / 100).toLocaleString('es-CL', { style: 'currency', currency: 'CLP' });
                    itemsList.innerHTML += `<div class="summary-item"><img src="${item.image || ''}" alt="${item.title}" class="summary-item-img"><div class="summary-item-details"><div class="summary-item-name" title="${item.title}">${item.title}</div><div class="summary-item-qty">Cantidad: ${item.quantity || 1}</div></div><div class="summary-item-price">${itemPrice}</div></div>`;
                });
                const totalFormatted = (cartData.total_price / 100).toLocaleString('es-CL', { style: 'currency', currency: 'CLP' });
                subtotalEl.textContent = totalFormatted;
                totalEl.textContent = totalFormatted;
                if (totalPreviewEl) totalPreviewEl.textContent = totalFormatted;
            }

            function updateProgressBar() {
                progressBarContainer.innerHTML = '';
                const stepLabels = ['Contacto', 'Despacho', 'Pago'];
                for (let i = 1; i <= totalSteps; i++) {
                    const stepEl = document.createElement('div');
                    stepEl.className = 'progress-step';
                    if (i < currentStep) stepEl.classList.add('completed');
                    if (i === currentStep) stepEl.classList.add('active');
                    stepEl.innerHTML = `<div class="step-circle">${i < currentStep ? 'âœ“' : i}</div><div class="step-label">${stepLabels[i - 1]}</div>`;
                    progressBarContainer.appendChild(stepEl);
                }
            }

            function updateButtons() {
                backButton.style.display = currentStep > 1 ? 'inline-flex' : 'none';
                if (currentStep === 1) nextButton.textContent = 'Continuar a Despacho';
                else if (currentStep === 2) nextButton.textContent = 'Continuar a Pago';
                else if (currentStep === totalSteps) nextButton.textContent = 'Pagar Ahora';
            }

            function changeStep(step) {
                if (step < 1 || step > totalSteps) return;
                const activeStep = document.querySelector('.checkout-step.active');
                if (activeStep) activeStep.classList.remove('active');
                
                currentStep = step;
                const newActiveStep = document.getElementById(`step${currentStep}-content`);
                if (newActiveStep) newActiveStep.classList.add('active');

                updateProgressBar();
                updateButtons();
                window.scrollTo(0, 0);
            }

            function validateStep(step) {
                const contentId = `step${step}-content`;
                const inputs = document.querySelectorAll(`#${contentId} [required]`);
                let isValid = true;
                inputs.forEach(input => {
                    if (input.offsetParent !== null && !input.value.trim()) {
                        isValid = false;
                        input.style.borderColor = 'var(--error)';
                    }
                });
                if (!isValid) {
                    const firstError = document.querySelector(`#${contentId} [required][style*="var(--error)"]`);
                    if (firstError) firstError.focus();
                }
                return isValid;
            }

            nextButton.addEventListener('click', () => {
                if (!validateStep(currentStep)) return;
                if (currentStep < totalSteps) {
                    changeStep(currentStep + 1);
                } else {
                    parent.postMessage({ type: 'redirect-to-checkout', message: "https://www.sua-loja.com/pages/gracias-por-tu-compra", origin: 'pinflag-shopify-pinmap-pro' }, '*');
                }
            });

            backButton.addEventListener('click', () => { changeStep(currentStep - 1); });

            window.addEventListener('message', (event) => {
                if (event.data.type === 'receive-cart-info') {
                    populateSummary(event.data.message);
                    parent.postMessage({ type: 'iframe-loaded', message: true, origin: 'pinflag-shopify-pinmap-pro' }, '*');
                }
            });
            
            // Re-seleciona os inputs apÃ³s serem injetados
            document.querySelectorAll('#checkoutForm .checkout-input[required]').forEach(input => {
                input.addEventListener('input', () => {
                    if (input.value.trim()) {
                        input.style.borderColor = '';
                    }
                });
            });

            const rutInput = document.getElementById('rut');
            if (rutInput) {
                rutInput.addEventListener('blur', function() {
                    let value = this.value.replace(/[^0-9kK.-]/g, '');
                    let cleanValue = value.replace(/[.-]/g, '');
                    if (cleanValue.length > 1) {
                        let body = cleanValue.slice(0, -1);
                        let dv = cleanValue.slice(-1).toUpperCase();
                        let formattedBody = body.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                        this.value = formattedBody + '-' + dv;
                    }
                });
            }

            updateProgressBar();
            updateButtons();
            // Ativa o primeiro passo manualmente
            const firstStep = document.getElementById('step1-content');
            if(firstStep) firstStep.classList.add('active');
        });
    </script>
</body>
</html>